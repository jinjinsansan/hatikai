(()=>{var e={};e.id=1928,e.ids=[1928],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},3685:e=>{"use strict";e.exports=require("http")},5687:e=>{"use strict";e.exports=require("https")},5477:e=>{"use strict";e.exports=require("punycode")},2781:e=>{"use strict";e.exports=require("stream")},7310:e=>{"use strict";e.exports=require("url")},9796:e=>{"use strict";e.exports=require("zlib")},8630:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>i.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>d,routeModule:()=>x,tree:()=>c}),r(5181),r(3370),r(9765);var s=r(9082),n=r(8410),a=r(1152),i=r.n(a),l=r(9785),o={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);r.d(t,o);let c=["",{children:["roulette",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,5181)),"/mnt/e/dev/hachikai/apps/web/app/roulette/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,3370)),"/mnt/e/dev/hachikai/apps/web/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,9765,23)),"next/dist/client/components/not-found-error"]}],d=["/mnt/e/dev/hachikai/apps/web/app/roulette/page.tsx"],u="/roulette/page",m={require:r,loadChunk:()=>Promise.resolve()},x=new s.AppPageRouteModule({definition:{kind:n.x.APP_PAGE,page:"/roulette/page",pathname:"/roulette",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},3954:(e,t,r)=>{Promise.resolve().then(r.bind(r,5941))},6706:(e,t,r)=>{Promise.resolve().then(r.bind(r,9091))},4350:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,7070,23)),Promise.resolve().then(r.t.bind(r,4426,23)),Promise.resolve().then(r.t.bind(r,3996,23)),Promise.resolve().then(r.t.bind(r,8235,23)),Promise.resolve().then(r.t.bind(r,1468,23)),Promise.resolve().then(r.t.bind(r,1864,23))},9091:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>l});var s=r(3704),n=r(5542),a=r(2748);function i({images:e,rotation:t,spinning:r,durationMs:n,selectedIdx:a}){let i=Math.max(e.length,1),l=360/i;return(0,s.jsxs)("div",{className:"relative",children:[s.jsx("div",{className:`relative h-56 w-56 md:h-72 md:w-72 rounded-full border-4 border-white/20 shadow-inner ${r?"spin-slow":""}`,style:r?void 0:{transform:`rotate(${t}deg)`,transition:`transform ${n}ms cubic-bezier(0.22, 1, 0.36, 1)`},children:e.map((e,t)=>{let r=t*l;return s.jsx("img",{src:e.src,alt:e.alt,className:`absolute left-1/2 top-1/2 h-12 w-12 -translate-x-1/2 -translate-y-1/2 rounded object-contain md:h-14 md:w-14 ${a===t?"img-ring-selected":"img-ring"} bg-white/5`,style:{transform:`rotate(${r}deg) translate(${i>10?135:i>6?125:110}px) rotate(${-r}deg)`}},e.id)})}),s.jsx("div",{className:"absolute left-1/2 top-[-10px] -translate-x-1/2",children:s.jsx("div",{className:"h-0 w-0 border-l-[12px] border-r-[12px] border-b-[18px] border-l-transparent border-r-transparent border-b-white"})}),s.jsx("div",{className:"pointer-events-none absolute left-1/2 top-1/2 h-16 w-16 -translate-x-1/2 -translate-y-1/2 rounded-full medal opacity-80 shadow-lg md:h-20 md:w-20"})]})}function l(){let[e,t]=(0,n.useState)(null),[r,l]=(0,n.useState)(!1),[o,c]=(0,n.useState)(null),[d,u]=(0,n.useState)(""),[m,x]=(0,n.useState)(0),[p,h]=(0,n.useState)(!1),[g,f]=(0,n.useState)(!1),b=(0,n.useRef)(0),[v,j]=(0,n.useState)([]),[w,y]=(0,n.useState)([]),[N,I]=(0,n.useState)(1800),[P,k]=(0,n.useState)(!1),[q,M]=(0,n.useState)(null),[_,S]=(0,n.useState)([]),$=(0,n.useRef)(null),U=(0,n.useRef)(0),z=(0,n.useRef)(0),C=(0,n.useRef)(0),A=(0,n.useRef)(0),R=(0,n.useRef)(null),T=e=>{null==R.current&&(R.current=e);let t=(e-R.current)/1e3;if(R.current=e,r)U.current=(U.current+z.current*t)%360;else if(C.current>0){let e=Math.max(0,z.current-C.current*t),r=(z.current+e)/2*t;A.current=Math.max(0,A.current-r),U.current=(U.current+r)%360,z.current=e,(e<=0||A.current<=.2)&&(C.current=0,z.current=0)}x(U.current),$.current=requestAnimationFrame(T)},Z=()=>{if(e&&!r){if(!w.length){u("欲しいものリストにアイテムを追加してください");return}u(""),c(null),l(!0),z.current=360,R.current=null,null==$.current&&($.current=requestAnimationFrame(T))}},J=e=>{r||l(!0),z.current=360,setTimeout(()=>{let t=360/w.length;l(!1);let r=(360-((-90+t/2+e*t)%360+360)%360-(U.current%360+360)%360)%360+1080;A.current=r;let s=Math.max(180,z.current);C.current=s*s/(2*r),z.current=s},150)};return(0,s.jsxs)("main",{children:[s.jsx("h1",{className:"text-2xl font-bold",children:"ルーレット"}),s.jsx(a.Z,{title:"演出",children:(0,s.jsxs)("div",{className:"flex flex-col items-center gap-4 md:flex-row",children:[(0,s.jsxs)("div",{className:r?"pointer-wiggle":"",children:[s.jsx(i,{images:w.map(e=>({...e,src:`/api/img-proxy?url=${encodeURIComponent(e.src)}`})),rotation:m,spinning:r,durationMs:N,selectedIdx:o}),s.jsx("div",{className:`pointer-events-none absolute left-1/2 top-1/2 h-16 w-16 -translate-x-1/2 -translate-y-1/2 rounded-full medal opacity-80 shadow-lg md:h-20 md:w-20 ${g?"medal-win":""}`}),!P&&s.jsx("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 rounded bg-black/50 px-3 py-2 text-sm",children:"読み込み中..."})]}),(0,s.jsxs)("div",{className:"space-y-2 w-full md:w-auto",children:[(0,s.jsxs)("div",{className:"flex gap-2",children:[s.jsx("button",{className:"btn btn-primary w-full md:w-auto",onClick:Z,disabled:!e||r||!P,children:"スタート"}),s.jsx("button",{className:"btn w-full md:w-auto",onClick:()=>{if(!r)return;let t=Math.floor(Math.random()*w.length);c(t);let s=360/w.length,n=-90+s/2+t*s;l(!1);let a=(360-(n%360+360)%360-(U.current%360+360)%360)%360+360*(4+Math.floor(3*Math.random()));A.current=a;let i=Math.max(180,z.current),o=i*i/(2*a);C.current=o,z.current=i,setTimeout(async()=>{h(!0);try{navigator.vibrate?.(50)}catch{}setTimeout(()=>h(!1),900),f(!0),setTimeout(()=>f(!1),900),b.current=(U.current%360+360)%360;let r=v[w[t].origIndex];try{await fetch("/api/me/roulette/wins",{method:"POST",headers:{"content-type":"application/json",authorization:`Bearer ${e}`},body:JSON.stringify({itemId:r.id,title:r.title,imageUrl:r.imageUrl,productUrl:r.productUrl})})}catch{}},Math.max(1500,i/o*500))},disabled:!r,children:"ストップ"})]}),null!=o&&w[o]&&v[w[o].origIndex]&&s.jsx("div",{className:"text-sm","aria-live":"polite",children:(0,s.jsxs)("div",{className:"mt-2 flex items-center gap-3",children:[s.jsx("img",{src:v[w[o].origIndex].imageUrl,alt:v[w[o].origIndex].title,className:"h-12 w-12 rounded object-contain"}),(0,s.jsxs)("div",{children:[s.jsx("div",{className:"font-medium",children:v[w[o].origIndex].title}),(0,s.jsxs)("div",{className:"mt-1 flex flex-wrap items-center gap-2",children:[s.jsx("a",{className:"btn",href:v[w[o].origIndex].productUrl,target:"_blank",rel:"noopener noreferrer",onClick:async t=>{t.preventDefault(),await fetch(`/api/me/wish-items/${v[w[o].origIndex].id}/click`,{method:"POST",headers:{authorization:`Bearer ${e}`}}),window.open(v[w[o].origIndex].productUrl,"_blank","noopener,noreferrer")},children:"Amazonで見る"}),s.jsx("button",{className:"btn",onClick:async()=>{try{await navigator.clipboard.writeText(`${v[w[o].origIndex].title}
${v[w[o].origIndex].productUrl}`)}catch{}},children:"コピー"}),s.jsx("button",{className:"btn",onClick:async()=>{let e=v[w[o].origIndex].productUrl,t=`これ欲しい！ ${v[w[o].origIndex].title}`;if(navigator.share)try{await navigator.share({title:"ハチカイ",text:t,url:e})}catch{}else window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(t)}&url=${encodeURIComponent(e)}`,"_blank")},children:"共有"})]})]})]})}),d&&s.jsx("p",{className:"text-sm text-red-300",children:d}),s.jsx("p",{className:"text-sm text-white/70",children:"※ 画像はあなたの欲しいものリストから。外部サイト（Amazon）へのリンクは新しいタブで開きます。"})]})]})}),s.jsx(a.Z,{title:"使い方",children:(0,s.jsxs)("ol",{className:"list-decimal pl-5 text-sm text-white/70",children:[s.jsx("li",{children:"「欲しいもの」ページでAmazon商品のURLと画像URLを登録"}),s.jsx("li",{children:"このページでスタート→画像が回転→ストップで候補が停止"}),s.jsx("li",{children:"「Amazonで見る」で商品ページを開く（外部サイト）"})]})}),s.jsx(a.Z,{title:"当選履歴（最近）",children:_.length?s.jsx("ul",{className:"divide-y divide-white/10 text-sm",children:_.map(e=>(0,s.jsxs)("li",{className:"flex items-center justify-between py-2",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[s.jsx("img",{src:`/api/img-proxy?url=${encodeURIComponent(e.imageUrl)}`,alt:e.title,className:"h-10 w-10 rounded object-contain"}),(0,s.jsxs)("div",{children:[s.jsx("div",{className:"font-medium",children:e.title}),s.jsx("div",{className:"text-xs text-white/60",children:new Date(e.decidedAt).toLocaleString()})]})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[s.jsx("a",{className:"btn",href:e.productUrl,target:"_blank",rel:"noopener noreferrer",children:"Amazon"}),s.jsx("button",{className:"btn",onClick:()=>{let t=w.findIndex(t=>v[t.origIndex]?.id===e.itemId);t>=0&&(r||Z(),setTimeout(()=>{J(t)},200))},children:"リプレイ"})]})]},e.id))}):s.jsx("div",{className:"text-sm text-white/60",children:"まだ当選履歴がありません"})})]})}r(1873)},5941:(e,t,r)=>{"use strict";function s(){return null}r.d(t,{default:()=>s}),r(5542)},2748:(e,t,r)=>{"use strict";r.d(t,{Z:()=>n});var s=r(3704);function n({title:e,children:t}){return(0,s.jsxs)("section",{className:"mt-6 card",children:[s.jsx("h2",{className:"mb-3 text-lg font-semibold",children:e}),t]})}},1873:(e,t,r)=>{"use strict";r.d(t,{O:()=>s});let s=(0,r(3462).eI)("https://pzuqtdvqgiyxmhldsdpu.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB6dXF0ZHZxZ2l5eG1obGRzZHB1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgzMzU0OTMsImV4cCI6MjA3MzkxMTQ5M30.qXGBAuhvvK77dJmCmVe4aneEbEEcqFFe_q_DeQ_Mwx4")},3370:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>d,metadata:()=>c});var s=r(9264);r(1923);var n=r(6121);let a=(0,n.createProxy)(String.raw`/mnt/e/dev/hachikai/apps/web/components/AppInit.tsx`),{__esModule:i,$$typeof:l}=a;a.default;let o=(0,n.createProxy)(String.raw`/mnt/e/dev/hachikai/apps/web/components/AppInit.tsx#default`),c={title:"ハチカイ",description:"階層\xd7ルーレット MVP"};function d({children:e}){return(0,s.jsxs)("html",{lang:"ja",children:[(0,s.jsxs)("head",{children:[s.jsx("link",{rel:"manifest",href:"/manifest.webmanifest"}),s.jsx("meta",{name:"theme-color",content:"#0b0b10"}),s.jsx("link",{rel:"icon",href:"/icons/icon-192.svg"}),s.jsx("link",{rel:"apple-touch-icon",href:"/icons/icon-192.svg"})]}),s.jsx("body",{className:"min-h-screen font-sans antialiased",children:(0,s.jsxs)("div",{className:"mx-auto max-w-5xl px-4 py-6",children:[s.jsx(o,{}),e]})})]})}},5181:(e,t,r)=>{"use strict";r.r(t),r.d(t,{$$typeof:()=>i,__esModule:()=>a,default:()=>l});var s=r(6121);let n=(0,s.createProxy)(String.raw`/mnt/e/dev/hachikai/apps/web/app/roulette/page.tsx`),{__esModule:a,$$typeof:i}=n;n.default;let l=(0,s.createProxy)(String.raw`/mnt/e/dev/hachikai/apps/web/app/roulette/page.tsx#default`)},1923:()=>{}};var t=require("../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[8915,7699,3462],()=>r(8630));module.exports=s})();