(()=>{var e={};e.id=4456,e.ids=[4456],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},3685:e=>{"use strict";e.exports=require("http")},5687:e=>{"use strict";e.exports=require("https")},5477:e=>{"use strict";e.exports=require("punycode")},2781:e=>{"use strict";e.exports=require("stream")},7310:e=>{"use strict";e.exports=require("url")},9796:e=>{"use strict";e.exports=require("zlib")},441:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>n.a,__next_app__:()=>m,originalPathname:()=>p,pages:()=>d,routeModule:()=>u,tree:()=>c}),s(9124),s(3370),s(9765);var i=s(9082),a=s(8410),r=s(1152),n=s.n(r),l=s(9785),o={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);s.d(t,o);let c=["",{children:["wishlist",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,9124)),"/mnt/e/dev/hachikai/apps/web/app/wishlist/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,3370)),"/mnt/e/dev/hachikai/apps/web/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,9765,23)),"next/dist/client/components/not-found-error"]}],d=["/mnt/e/dev/hachikai/apps/web/app/wishlist/page.tsx"],p="/wishlist/page",m={require:s,loadChunk:()=>Promise.resolve()},u=new i.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/wishlist/page",pathname:"/wishlist",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},3954:(e,t,s)=>{Promise.resolve().then(s.bind(s,5941))},3335:(e,t,s)=>{Promise.resolve().then(s.bind(s,6211))},4350:(e,t,s)=>{Promise.resolve().then(s.t.bind(s,7070,23)),Promise.resolve().then(s.t.bind(s,4426,23)),Promise.resolve().then(s.t.bind(s,3996,23)),Promise.resolve().then(s.t.bind(s,8235,23)),Promise.resolve().then(s.t.bind(s,1468,23)),Promise.resolve().then(s.t.bind(s,1864,23))},6211:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>n});var i=s(3704),a=s(5542),r=s(2748);function n(){let[e,t]=(0,a.useState)(null),[s,n]=(0,a.useState)([]),[l,o]=(0,a.useState)(""),[c,d]=(0,a.useState)(""),[p,m]=(0,a.useState)(""),[u,h]=(0,a.useState)(""),[x,g]=(0,a.useState)(!1),[b,f]=(0,a.useState)(null),j=async()=>{if(!e)return;let t=await fetch("/api/me/wish-items",{headers:{authorization:`Bearer ${e}`}});t.ok&&n(await t.json())},v=async()=>{if(h(""),!l||!c||!p){h("タイトル/商品URL/画像URLは必須です");return}if(!/amazon\./.test(c)){h("商品URLはAmazonのドメインである必要があります");return}let t=await fetch("/api/me/wish-items",{method:"POST",headers:{"content-type":"application/json",authorization:`Bearer ${e}`},body:JSON.stringify({title:l,productUrl:c,imageUrl:p})}),s=await t.json();t.ok?(o(""),d(""),m(""),j()):h(s?.error||"保存に失敗しました")},w=async()=>{if(h(""),!c){h("商品URLを入力してください");return}let e=await fetch(`/api/og?url=${encodeURIComponent(c)}`),t=await e.json();e.ok&&t?.imageUrl?(!l&&t.title&&o(t.title),m(t.imageUrl),g(!0)):h(t?.error||"OG画像が取得できませんでした（URL/地域によって取得できない場合があります）")},y=async t=>{(await fetch(`/api/me/wish-items/${t}`,{method:"DELETE",headers:{authorization:`Bearer ${e}`}})).ok&&j()};return(0,i.jsxs)("main",{children:[i.jsx("h1",{className:"text-2xl font-bold",children:"欲しいものリスト"}),(0,i.jsxs)(r.Z,{title:"追加",children:[(0,i.jsxs)("div",{className:"grid gap-2 md:grid-cols-2",children:[i.jsx("input",{className:"input",placeholder:"タイトル",value:l,onChange:e=>o(e.target.value)}),(0,i.jsxs)("div",{className:"flex gap-2",children:[i.jsx("input",{className:"input",placeholder:"商品URL（Amazon）",value:c,onChange:e=>d(e.target.value)}),!p&&i.jsx("button",{className:"btn",type:"button",onClick:w,children:"画像自動取得"})]}),i.jsx("input",{className:"input",placeholder:"画像URL（Amazonの商品画像など）",value:p,onChange:e=>m(e.target.value)}),i.jsx("button",{className:"btn",onClick:v,children:"追加"})]}),u&&i.jsx("p",{className:"mt-2 text-sm text-red-300",children:u}),p&&(0,i.jsxs)("div",{className:"mt-3 text-sm text-white/70",children:["プレビュー：",i.jsx("br",{}),i.jsx("img",{src:p,alt:"preview",className:"mt-1 max-h-48 rounded border border-white/10"})]})]}),i.jsx(r.Z,{title:"登録済み",children:s.length?i.jsx("div",{className:"grid gap-3 md:grid-cols-3",children:s.map(t=>(0,i.jsxs)("div",{className:"card",children:[i.jsx("img",{src:`/api/img-proxy?url=${encodeURIComponent(t.imageUrl)}`,alt:t.title,className:"h-40 w-full rounded object-contain"}),i.jsx("div",{className:"mt-2 text-sm font-medium",children:t.title}),(0,i.jsxs)("div",{className:"mt-2 flex flex-wrap items-center gap-2",children:[i.jsx("a",{className:"btn",href:t.productUrl,target:"_blank",rel:"noopener noreferrer",children:"Amazonで見る"}),i.jsx("button",{className:"btn",onClick:()=>y(t.id),children:"削除"}),(0,i.jsxs)("div",{className:"ml-auto flex items-center gap-2 text-sm",children:[i.jsx("span",{children:"重み"}),i.jsx("input",{className:"input w-24",type:"number",step:"0.1",min:.1,value:t.weight??1,onChange:e=>n(s=>s.map(s=>s.id===t.id?{...s,weight:Number(e.target.value)}:s))}),i.jsx("button",{className:"btn",onClick:async()=>{await fetch(`/api/me/wish-items/${t.id}`,{method:"PATCH",headers:{"content-type":"application/json",authorization:`Bearer ${e}`},body:JSON.stringify({weight:Number(t.weight)||1})})},children:"保存"})]})]})]},t.id))}):i.jsx("div",{className:"text-sm text-white/60",children:"まだ登録がありません"})}),(0,i.jsxs)(r.Z,{title:"画像アップロード（将来のCDN最適化）",children:[i.jsx("div",{className:"text-sm text-white/70",children:"S3を設定済みの場合、ローカル画像をアップロードし、画像URLを自動入力できます。"}),(0,i.jsxs)("div",{className:"mt-2 flex flex-wrap items-center gap-2",children:[i.jsx("input",{type:"file",className:"input",accept:"image/*",onChange:e=>f(e.target.files?.[0]||null)}),i.jsx("button",{className:"btn",onClick:async()=>{if(h(""),!b){h("画像ファイルを選択してください");return}let e=await fetch("/api/uploads/s3-sign",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({filename:b.name,contentType:b.type})}),t=await e.json();if(!e.ok||t?.error){h("署名エラー: AWS設定と依存パッケージの導入が必要です");return}if(!(await fetch(t.uploadUrl,{method:"PUT",headers:{"content-type":b.type},body:b})).ok){h("アップロードに失敗しました");return}m(t.publicUrl)},children:"アップロードしてURLに反映"})]})]})]})}s(1873)},5941:(e,t,s)=>{"use strict";function i(){return null}s.d(t,{default:()=>i}),s(5542)},2748:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});var i=s(3704);function a({title:e,children:t}){return(0,i.jsxs)("section",{className:"mt-6 card",children:[i.jsx("h2",{className:"mb-3 text-lg font-semibold",children:e}),t]})}},1873:(e,t,s)=>{"use strict";s.d(t,{O:()=>i});let i=(0,s(3462).eI)("https://pzuqtdvqgiyxmhldsdpu.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB6dXF0ZHZxZ2l5eG1obGRzZHB1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgzMzU0OTMsImV4cCI6MjA3MzkxMTQ5M30.qXGBAuhvvK77dJmCmVe4aneEbEEcqFFe_q_DeQ_Mwx4")},3370:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>d,metadata:()=>c});var i=s(9264);s(1923);var a=s(6121);let r=(0,a.createProxy)(String.raw`/mnt/e/dev/hachikai/apps/web/components/AppInit.tsx`),{__esModule:n,$$typeof:l}=r;r.default;let o=(0,a.createProxy)(String.raw`/mnt/e/dev/hachikai/apps/web/components/AppInit.tsx#default`),c={title:"ハチカイ",description:"階層\xd7ルーレット MVP"};function d({children:e}){return(0,i.jsxs)("html",{lang:"ja",children:[(0,i.jsxs)("head",{children:[i.jsx("link",{rel:"manifest",href:"/manifest.webmanifest"}),i.jsx("meta",{name:"theme-color",content:"#0b0b10"}),i.jsx("link",{rel:"icon",href:"/icons/icon-192.svg"}),i.jsx("link",{rel:"apple-touch-icon",href:"/icons/icon-192.svg"})]}),i.jsx("body",{className:"min-h-screen font-sans antialiased",children:(0,i.jsxs)("div",{className:"mx-auto max-w-5xl px-4 py-6",children:[i.jsx(o,{}),e]})})]})}},9124:(e,t,s)=>{"use strict";s.r(t),s.d(t,{$$typeof:()=>n,__esModule:()=>r,default:()=>l});var i=s(6121);let a=(0,i.createProxy)(String.raw`/mnt/e/dev/hachikai/apps/web/app/wishlist/page.tsx`),{__esModule:r,$$typeof:n}=a;a.default;let l=(0,i.createProxy)(String.raw`/mnt/e/dev/hachikai/apps/web/app/wishlist/page.tsx#default`)},1923:()=>{}};var t=require("../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),i=t.X(0,[8915,7699,3462],()=>s(441));module.exports=i})();